# 前端项目问题以及改进方案

参加几个前端项目后，发现了一些能改进的问题，并提出了一些改进方案，希望能帮助提升项目的质量和效率，保证项目的可维护性。

## 代码风格不统一

代码风格不统一会导致代码难以阅读和维护。不同人可能有不同的编码习惯，导致代码风格混乱。

1. 大家不敢合并代码，害怕引起冲突。
2. 他人不在时，你修复一个紧急的 bug，他说风格又变了，自己又不习惯了，引发不必要的协作摩擦。
3. 不方便追溯 git 历史，因为 commit 里可能有大量格式改动。
4. 有的成员习惯不好，该缩进的不缩进，该换行的不换行，导致代码可读性差，难以维护。
5. 代码风格不统一，当需要全局搜索，然后再替换的时候，不方便。

### 单引号和双引号混用

![](https://cdn.jsdelivr.net/npm/zqj-pics/code-style/better-space-diff.png)

该有空格的没有空格，单双引号混用。

当需要全局搜索的时候，不方便

优化后

![](https://cdn.jsdelivr.net/npm/zqj-pics/code-style/better-space-same.png)

### 有分号和无分号混用

![](https://cdn.jsdelivr.net/npm/zqj-pics/code-style/has-semi-vs-no-semi.png)

### 代码排版混乱，该缩进的不缩进，该对齐的不对齐

![](https://cdn.jsdelivr.net/npm/zqj-pics/code-style/混乱的格式.png)

优化后

![](https://cdn.jsdelivr.net/npm/zqj-pics/code-style/混乱的度格式-重构后.png)

### 行宽太大

![](https://cdn.jsdelivr.net/npm/zqj-pics/code-style/too-length-264列.png)

> 264 列太长了，建议不要超过 100 列。
> 太长的行宽会导致代码难以阅读，编辑器出现横线滚动条，建议控制在 80-110 列之间。

### 依赖导入顺序混乱

![](https://cdn.jsdelivr.net/npm/zqj-pics/code-style/bad-import.png)

![](https://cdn.jsdelivr.net/npm/zqj-pics/code-style/import-mess-bad.png)

业务代码和依赖导入混在一起，相互穿插，读起来头大。

更好的方式：

![](https://cdn.jsdelivr.net/npm/zqj-pics/code-style/better-import.png)

![](https://cdn.jsdelivr.net/npm/zqj-pics/code-style/import-mess-better.png)

依赖导入放在文件最上方，且对不同来源的依赖进行**按照距离远近分组**，在依赖导入后才写代码。

> 美观一致的代码排版是可读性的基础，能有效提高代码可读性，降低认知负担，提高协作效率。

## 语法错误

团队成员可能水平不同，或者细心程度不同，偶尔写错误语法。

### 拼写错误

![](https://cdn.jsdelivr.net/npm/zqj-pics/code-style/语法错误-2.png)

`type` 拼写成 `types`。

### 重置内置函数

![](https://cdn.jsdelivr.net/npm/zqj-pics/code-style/语法错误-3.png)

把 js 数组的内置函数重置了。

### props 支持多种类型错误

![](https://cdn.jsdelivr.net/npm/zqj-pics/code-style/props-type-error.png)

希望组件 props 支持多种类型的数据，前两种是错误语法，第三种才是对的。

### 模板错误

![](https://cdn.jsdelivr.net/npm/zqj-pics/code-style/语法错误-多一个尖括号.png)

多了`>`。

## 一些代码异味

代码异味虽然不算严重的问题，但是它非常容易引发 bug，也要引起重视，否则会导致代码难以维护。

### 参数过多

![](https://cdn.jsdelivr.net/npm/zqj-pics/code-style/too-many-params.png)1

13个参数，导致这个函数难以使用，有一个参数顺序不对，就可能导致 bug。

其他例子不再举例。

### 意外重置变量导致 bug

![](https://cdn.jsdelivr.net/npm/zqj-pics/code-style/let意外重置导致的bug.png)

forEach 的第一次循序，把 顶部的 key 重置了，导致第二次循环出问题。

这个问题开发登录功能，导致前端后排查了挺久。

改进方案，统一采用 const 声明变量，除非需要再次赋值才使用 let，能避免变量意外重置导致 bug。

> js 中需要再次重置变量的场景很少，正因为 let 变量存在这样的风险，很多代码规范都优先使用 const。

比如质量检查工具 [eslint -- prefer-const](https://eslint.org/docs/latest/rules/prefer-const)

使用 const 就能有效避免这个问题。

![](https://cdn.jsdelivr.net/npm/zqj-pics/code-style/const-避免意外重置引发bug.png)

### 样式重复

![](https://cdn.jsdelivr.net/npm/zqj-pics/code-style/样式重复-1.png)

### 嵌套过深

我在四预项目里看到**有 8 层嵌套的 for 循环**，就不贴代码了。

## 我的改进建议

当发现这些问题时候，我积极寻找解决办法，我建议这样改进：

1. 项目里加入 prettier，在代码提交前执行 prettier，强制格式化统一风格。

新老项目都适用，因为他只会格式化提交的文件，即有修动的文件。对老项目而言，随着文件改动得越来越多，风格不统一的问题就逐渐缓解了。

2. 新项目加入 eslint 质量检查

[eslint](https://eslint.org/) 是前端项目常用的质量检查的工具，可以防止不好的编码实践，避免代码异味，从而保证团队的编码质量。

一些常见的代码异味，会自动修复，无法自动修复了，需要手动修复。

> 老项目也可以加入 eslint，可以设置在提交前对改动的文件进行检查，不会影响不改动的文件。但是可能会增加项目成员负担，因为已经存在的文件，可能有有很多代码异味，需要手动修复。

当我提出这些问题和改进方案时，得到反馈非常消极，主要有四种：

1. 公司代码的风格10多年了，熙哥都没统一过，我不能统一，不要自作聪明。
2. 没必要统一风格，我喜欢自己的风格，各人的代码各人改。**但是不可避免要去阅读和修改他人的代码**，比如修复紧急bug。
3. 不了解 prettier 和 eslint 这类保证代码质量的工具，认为统一代码风格和质量检查是无用功。
4. 公司没要求，就没必要整这么复杂，有人从外面回贵阳，就是来公司做一天和尚撞一天钟，不能要求别人什么质量怎样。

以上问题在我们前端项目应该说是长久以来普遍存在的，也切切实实影响项目维护和协作，今天特地整理一些典型问题。

您作为公司的架构师，对这些问题会有更深入全面的看法，希望能多多帮助推动类问题的解决。

能让前端团队认识到以上问题的危害，代码风格和质量对协作的重要性，**最好能综合前端同事的一些意见，在认知上达成统一，制定前端项目可实施的质量标准，并结合上面我提到的两个工具自动化地落实。**

> 我可以起草一份前端质量规范，再来综合大家的意见。

### 其他一些建议

我刚来公司的时候，就发现李光余作为前端架构师，工作方式不太好，主要有两点：

1. 几乎不和前端成员沟通他的工作进展，导致我们不知道他写代码处在什么状态了，bug 修复了没有。
2. 从不号召前端成员参与基础库的开发，一个人闷头写。

这样的工作方式，会导致严重的技术债务，主要体现在：

1. 不和团队成员沟通工作进展，代码没第三人去验证，bug 修复没修复，我们都不知道，不利于协作。
2. 基础库的开发只有他参与，其他人不了解现实细节，文档也不完善。他离职后虽然安排了人接手，但是没持续维护，当遇需求改动和 bug，找到相关的人，也改不动。遗留代码就成为团队难以处理负债，而不是资产。

比如这个需求，找了几个人，没人能改动：[河道实时站点过程线，解决标注重叠的问题](https://www.tapd.cn/tapd_fe/53992610/story/detail/1153992610001003754)

我不太理解架构师有这样的工作方式，通常来说，不应该是这样的，我就斗胆评价一下，有如下可能:

1. 不知道如何技术架构师，不清楚架构师的工作职责和如何带领技术团队，沟通能力不太好，不具备带带团队的能力。
2. 知道如何做技术架构师，也具备沟通能力，但是刻意不想让团队成员了解设计思路和实现细节，从而保证自己在团队里优势。

不管是哪种，对团队和公司来说，都是有害的。

李光余走后，杨波做架构师，工作方式还是和李差不多，甚至更加严重了，之前基础库的仓库权限团队成员问他要，都没给我们。当然，经过我的反馈，后来公开了。但是需要跨项目使用的基础库，还是自己闷头写，从不关心有团队成员的意见，有没有其他人想要了解，想要参与开发，甚至对我们提出的改进建议，不关心不回应，而是写好了，给大家用。

以上就是我前端项目的一些认识，代码问题可公开，其他别公开了，我担心被针对了。
