# 测试中的模拟

代码会依赖一些外部环境或者模块，比如 http 接口、npm 模块、数据库等，集成这些环境往往会使得单元测试变复杂，真实环境也许是缓慢和脆弱的，比如真实环境要求定时器的间隔为 20 分钟，单元测试不可能等待 20 分钟，这些不稳定不可靠的**外部依赖**，在测试代码中需要给外部依赖创建一个假的替身，这就是所谓 mocking。

通过模拟，单元测试更加控件、稳定和快速。

vitest 提供了强大的 mocking 功能，支持对模块、函数、定时器、浏览器等的模拟，下面我们来看看如何使用 vitest 的 mocking 功能。

这一节先学习模拟函数、模块、浏览器和环境变量等，定时器和 http 接口的模拟会在后后续两面两节讲解。

<!--  fake mock stub spy -->

## 模拟模块

<!-- mock -->

## 模拟函数

<!--stub-->

## 监听模块行为

<!-- spy -->

## 模拟浏览器

<!-- 获取当前位置 -->

## 模拟环境变量

## 单元测试中 mock 和单一职责的关系

Martin Fowler 把单元测试分为两类：

- 社交型单元测试 -- 被测试的代码有外部依赖，单元测试中需要排除外部依赖的影响。
- 独立型单元测试 -- 被测试的代码没有外部依赖。

测试代码中需要很多 mock，反映出被测试代码没有很好地遵循单一职责的原则。遵循单一职责原则的代码，单元测试也会很容易编写，容易维护，所以写单元测试也是促使我们提高代码质量的手段之一。

相反，测试代码中 mock 越多，测试越不能给人信心，甚至是毫无作用的测试。

<!-- TODO 例子 -->

## 小结

##

https://blog.logrocket.com/advanced-guide-vitest-testing-mocking/
