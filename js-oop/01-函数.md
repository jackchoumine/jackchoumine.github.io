# 函数

函数是可调用的对象，其具有一个内部属性 -- [[call]]，其他对象没有这个属性。

该属性无法通过代码访问，而是在定义了函数执行时的行为。

typeof 对任何具有[[call]]属性的对象，返回 `function`。

函数是特殊的对象，理解函数的行为，是理解 JS 的关键。

## 声明式 vs 表达式 vs 箭头函数

定义函数有三种方式，它们的轻微差别。

> 还用 new Function 的方式声明函数，极少用到，就不学习了。

### 声明式

使用关键字`function` + 函数名，声明函数。

```js
add(1,3)
function add(n, m) {
  return n + m
}
add(1,4)
```

函数声明会被 js 引擎提升到作用域顶部，可先使用后声明。

### 表达式

使用变量接收匿名函数，通过变量调用函数，`function` 后的函数名是可选的。

```js
//add(1,4) // ❌
const add = function(n,m){
  return n + m
}
add(1,3)
```

表达式无法提示，必须先定义后使用。

### 箭头函数

```js
// add(1,4) // ❌
const add = (n,m)=> n + m
add(1,3)
```

不会提升，先声明后使用。

### 比较

| 声明方式   | 是否可先调用 | this 值                  | arguments                                  | rest         | 重复声明                               |
| ---------- | ------------ | ------------------------ | ------------------------------------------ | ------------ | -------------------------------------- |
| 函数声明   | ✅           | 调用时确定               | 实参                                       | 未声明的参数 | 最后一个生效                           |
| 函数表达式 | ❌           | 调用时确定               | 实参                                       | 未声明的参数 | 最后一个 var 生效，let 和 const 会报错 |
| 箭头函数   | ❌           | 用其最近的非箭头函数决定 | 没有 arguments，最近的外层函数的 arguments | 未声明的参数 | 同上                                   |

> 不涉及 this 的指向时，推荐使用 函数声明，因为它更加清楚和灵活。
> 涉及到 arguments 时，使用剩余参数代替，因为 arguments 行为比较怪异: 可被修改、不可返回。
> 函数签名：函数的唯一标识由函数名、参数和返回值决定。
> 箭头函数不能作为对象方法，因为其没有 this。

当涉及到不定参数时，使用剩余参数代替。

```js
function sum(...rest) {
  return rest.reduce((cur, total) => total + cur, 0)
}

console.log(sum())
console.log(sum(1, 2, 3))
console.log(sum(1, 2, 3, 4, 5))
```

## 函数是特殊的值

函数是可调用的值，具有值具备的特性：

- 可赋值给变量：可赋值给变量，可作为函数参数传递。
- 可作为返回值：函数返回一个函数，可再次调用。
- 可附加到对象上：可作为对象的属性。

### 可赋值给变量

```js
function sayHi(){
  console.log('Hi')
}
sayHi()
const sayHello = sayHi
sayHello()

function onClick(handler){
  window.addEventListener('click',handler)
}
onClick(sayHello)
```

> 传递给参数可作为赋值给参数的特殊情况。

### 作为返回值

```js
const plus100 = plus(100)
const result1 = plus100(10) // 100 + 10
const result2 = plus100(100) // 100 + 100
console.log({ result1, result2 })
```

> 函数作为返回值，作为返回值的函数可复用外层函数的参数，从而实现复用参数和简化参数传递的目的。

### 函数作为对象的属性

```js
const person = {
  sayHi,
}

person.sayHi()

function sayHi() {
  console.log('Hi')
}
```

#### 对象方法的 this 情况

this 永远指向调用该方法的对象。

```js
const xiaoMing = {
  name: '小明',
  printName: function () {
    console.log(this.name, 'printName name')
    function inner() {
      console.log('inner', this.name)
    }
    //inner()
    const arrow = () => {
      console.log('arrow', this.name)
    }
    arrow()
  },
  // 剪头函数不可作为对象方法 ❌
  sayName: () => {
    // console.log(this.name, 'sayName name') // 报错 ❌
    function inner() {
      console.log('inner', this.name) // 报错 ❌
    }
    const arrow = () => {
      console.log('arrow', this.name) // 报错 ❌
    }
  },
}
xiaoMing.printName()
xiaoMing.sayName()
```

## 箭头函数

### 箭头函数不可作为对象的方法

### 箭头函数可作为类的方法

```js
class A {
  name = 'AAAA'
  method = () => {
    console.log('A.name', this.name)
  }
  sayHi() {
    //console.log('this.name', this.name)
  }
}

const a = new A()
a.method()

const { method } = a
method()
a.sayHi()
const { sayHi: ASayHi } = a
ASayHi()
```

## 小结

- 函数可赋值给变量，可作为参数，可作为返回值。
- 箭头函数不能作为方法，可作为类的方法，指向类的实例。
