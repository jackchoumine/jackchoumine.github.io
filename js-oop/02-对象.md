# 对象

JS 是基于原型实现面向对象，而原型也是对象，因此可说基于对象的。

> JS 中所有变量都可看成对象，对象可能随时发生变化。基于类的语言会根据类的定义，锁定对象。

对象是动态的：属性可以随时添加和删除，非常灵活，当然也有手段限制这种类灵活性。

## 对象定义

有多种定义对象的方式，常用的有：字面量、构造函数（new Object、new Constructor）、工厂函数、`Object.create`等。

### 字面量

```js
const obj = {
  name: 'JS',
  age: 30,
}
```

特点：

- 简单直观；
- 原型为 `Object.prototype`。

### 构造函数

```js
const obj = new Object({
  name: 'JS',
  age: 30,
})
```

实际上字面量语法，js 引擎就是做了构造函数做的事情。

> 很少使用这种方式。

### 对象定义小结

<!-- TODO -->

## 属性操作

对属性进行**增、改、查、删**

### 增加

```js
const obj = {}
obj.name = 'Tom'
```

当属性第一次添加到对象上，会调用一个内置的`[[Put]]`方法，会在对象上创建一个`自有属性`，自有属性是对象拥有的属性，对自有属性的操作都必须通过该对象。

当对已有属性赋新值，会调用一个内置的`[[Set]]`方法，访问属性时，会调用`[[Get]]`方法。

### 改写属性值

直接赋值。

### 检查属性是否存在

#### if 语言

```js
if (obj.name) {
  // do something
}
```

> 会检查属性的值，属性值为`falsy`，条件为假。
> 会检查原型属性。

#### in 操作符

```js
if (name in obj) {
  //do something
}
```

> 不检查属性值。

> 会检查原型属性。

#### hasOwnProperty

仅检查自有属性。

```js
const hasProp = obj.hasOwnProperty('key')
```

### 棘手的属性检查

通过上面的介绍，可看出，JS 检查属性存在还是一个挺麻烦的事情，可封装一个通用的函数来做这件事。

```js
function hasProp(obj, key, checkPrototype = false) {
  if (!checkPrototype) return obj.hasOwnProperty(key)
  return key in obj
}
```

### 属性遍历

<!--TODO -->
### 移除属性

> 移除属性，通过`delete`操作符实现，移除成功，返回 true。

使用 delete 操作符时，会调用内置方法`[[Delete]]`。

```js
const obj = {
  name: 'JS',
}
const removed = delete obj.name
if (removed) {
  console.log('已经移除 name')
}
```

## 禁止修改对象

对象非常灵活，可随时被修改，有时候我们并不希望这样。可通过三种方式禁止修改对象。

### 禁止添加属性（禁止扩展） -- Object.preventExtensions

```js
const obj = {
  name: 'JS',
}

Object.preventExtensions(obj)

obj.age = 30 // 报错  TypeError: Cannot add property age, object is not extensible
```

> Object.isExtensible 可检查对象是否可扩展。

### 禁止添加和删除属性（封印） -- Object.seal

```js
const obj = {
  name: 'JS',
}
Object.seal(obj)
console.log(Object.isSealed(obj))
const removed = delete obj.name // 报错  TypeError: Cannot delete property 'name' of #<Object>
```

> Object.isSealed 检查是否封印。

### 禁止修改属性值 -- Object.freeze

不能添加属性、不能删除属性、不能修改属性，对象变成只读的。

> Object.isFrozen()来判断一个对象是否被冻结。

### 禁止修改对象对比

| 特性                 | `Object.preventExtensions()` | `Object.seal()`                | `Object.freeze()`           |
| -------------------- | ---------------------------- | ------------------------------ | --------------------------- |
| 是否可添加新属性     | ❌ 否                        | ❌ 否                          | ❌ 否                       |
| 是否可删除属性       | ✅ 是                        | ❌ 否                          | ❌ 否                       |
| 是否可修改已有属性值 | ✅ 是                        | ✅ 是                          | ❌ 否（值和描述符都不可改） |
| 是否可修改属性描述符 | ✅ configurable 可改         | ❌ 所有属性 configurable=false | ❌ 所有属性都不可改         |
| 是否递归作用         | ❌ 否                        | ❌ 否                          | ❌ 否（只作用于第一层）     |
| 是否可撤销（解封）   | ❌ 否                        | ❌ 否                          | ❌ 否                       |
| 用途                 | 禁止扩展                     | 锁定结构但允许值修改           | 使对象变成只读              |


freeze 防止修改最彻底，常用于声明一个不可变的对象。

> 浅冻结：freeze 不会递归冻结嵌套对象，需手动深度冻结。

```js
function deepFreeze(obj) {
  Object.freeze(obj)
  for (const key in obj) {
    if (typeof obj[key] === 'object') deepFreeze(obj[key])
  }
}
```