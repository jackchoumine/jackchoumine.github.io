import{_ as s,o as a,c as n,a as l}from"./app.25b76eb2.js";const A=JSON.parse('{"title":"leaflet 标记聚合","description":"","frontmatter":{},"headers":[{"level":2,"title":"在地图上添加标记","slug":"在地图上添加标记","link":"#在地图上添加标记","children":[]},{"level":2,"title":"如何配置聚合插件？","slug":"如何配置聚合插件","link":"#如何配置聚合插件","children":[]},{"level":2,"title":"可以聚合其他图层吗，比如 circleMarker ？","slug":"可以聚合其他图层吗-比如-circlemarker","link":"#可以聚合其他图层吗-比如-circlemarker","children":[]},{"level":2,"title":"关于 FeatureGroup","slug":"关于-featuregroup","link":"#关于-featuregroup","children":[]},{"level":2,"title":"关于聚合容差 tolerance","slug":"关于聚合容差-tolerance","link":"#关于聚合容差-tolerance","children":[]},{"level":2,"title":"参考","slug":"参考","link":"#参考","children":[]}],"relativePath":"web-gis/leaflet点聚合.md"}'),p={name:"web-gis/leaflet点聚合.md"},e=l(`<h1 id="leaflet-标记聚合" tabindex="-1">leaflet 标记聚合 <a class="header-anchor" href="#leaflet-标记聚合" aria-hidden="true">#</a></h1><p>在地图上标记大量的点时，如果点之间的距离很小，当地图缩小时，点会重叠在一起，遮挡地图，这时候就需要对点进行聚合，当地图缩小时，点会聚合在一起，当地图放大时，点会分散开来。</p><p>使用 leaflet 的插件<code>leaflet.markercluster</code>来标记聚合。</p><h2 id="在地图上添加标记" tabindex="-1">在地图上添加标记 <a class="header-anchor" href="#在地图上添加标记" aria-hidden="true">#</a></h2><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> featureGroup </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">FeatureGroup</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">  threeMakerInGuiYang</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">features</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">forEach</span><span style="color:#A6ACCD;">(</span><span style="color:#A6ACCD;font-style:italic;">feature</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">marker</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">Marker</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">      [</span><span style="color:#A6ACCD;">feature</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">geometry</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">coordinates</span><span style="color:#F07178;">[</span><span style="color:#F78C6C;">1</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">feature</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">geometry</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">coordinates</span><span style="color:#F07178;">[</span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">]]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        icon</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">Icon</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">          iconUrl</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">data:image/svg+xml;utf8,</span><span style="color:#89DDFF;">\${</span><span style="color:#82AAFF;">encodeURIComponent</span><span style="color:#A6ACCD;">(redSvg)</span><span style="color:#89DDFF;">}\`</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">          iconSize</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span><span style="color:#F78C6C;">30</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">30</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">          iconAnchor</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span><span style="color:#F78C6C;">15</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">15</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    )</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">marker</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">addTo</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">featureGroup</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">  featureGroup</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">addTo</span><span style="color:#A6ACCD;">(map)</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>地图放缩级别为<code>13</code>时的标记</p><p><img src="https://jsd.cdn.zzko.cn/gh/jackchoumine/jack-picture@master/marker-cluster-before.png" alt=""></p><p>缩小，标记重叠</p><p><img src="https://jsd.cdn.zzko.cn/gh/jackchoumine/jack-picture@master/marker-overlap.png" alt=""></p><p>使用 leaflet 聚合插件，优化显示：</p><ol><li>安装插件</li></ol><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">i</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">leaflet.markercluster</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ol start="2"><li>引入插件</li></ol><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">leaflet.markercluster/dist/MarkerCluster.css</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">leaflet.markercluster/dist/MarkerCluster.Default.css</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">MarkerClusterGroup</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">leaflet.markercluster</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>使用<code>MarkerClusterGroup</code>代替<code>FeatureGroup</code></p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">// const featureGroup = new FeatureGroup()</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> featureGroup </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">MarkerClusterGroup</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>地图放缩级别为<code>13</code>时的标记，距离很近的标记会聚合在一起，并有数字标记聚合的数量</p><p><img src="https://jsd.cdn.zzko.cn/gh/jackchoumine/jack-picture@master/marker-cluster-after.png" alt=""></p><p>地图缩小到一定级别，标记聚合成一个</p><p><img src="https://jsd.cdn.zzko.cn/gh/jackchoumine/jack-picture@master/marker-cluster-to-one.png" alt=""></p><h2 id="如何配置聚合插件" tabindex="-1">如何配置聚合插件？ <a class="header-anchor" href="#如何配置聚合插件" aria-hidden="true">#</a></h2><p>配置项有点多，等需要时再来了解吧。</p><p>文档：<a href="https://github.com/Leaflet/Leaflet.markercluster" target="_blank" rel="noreferrer">markercluster</a></p><h2 id="可以聚合其他图层吗-比如-circlemarker" tabindex="-1">可以聚合其他图层吗，比如 circleMarker ？ <a class="header-anchor" href="#可以聚合其他图层吗-比如-circlemarker" aria-hidden="true">#</a></h2><p>可以聚合 circleMarker，其他不行。</p><h2 id="关于-featuregroup" tabindex="-1">关于 FeatureGroup <a class="header-anchor" href="#关于-featuregroup" aria-hidden="true">#</a></h2><p>FeatureGroup 要素组，扩展了 LayerGroup，方便对所有要素图层进行操作，比如添加到地图上，移除等。</p><p>文档：<a href="https://leafletjs.cn/reference.html#featuregroup" target="_blank" rel="noreferrer">featuregroup</a></p><p>比如：</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// 点  圆点</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">CircleMarker</span><span style="color:#A6ACCD;">([</span><span style="color:#F78C6C;">26.5509186</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">106.557411</span><span style="color:#A6ACCD;">])</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">addTo</span><span style="color:#A6ACCD;">(featureGroup)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// 线</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Polyline</span><span style="color:#A6ACCD;">([</span></span>
<span class="line"><span style="color:#A6ACCD;">    [</span><span style="color:#F78C6C;">26.5509186</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">106.597411</span><span style="color:#A6ACCD;">]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    [</span><span style="color:#F78C6C;">26.5599186</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">106.587411</span><span style="color:#A6ACCD;">]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  ])</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">addTo</span><span style="color:#A6ACCD;">(featureGroup)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// 面</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Polygon</span><span style="color:#A6ACCD;">([</span></span>
<span class="line"><span style="color:#A6ACCD;">    [</span><span style="color:#F78C6C;">26.5599186</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">106.577411</span><span style="color:#A6ACCD;">]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    [</span><span style="color:#F78C6C;">26.5599186</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">106.527411</span><span style="color:#A6ACCD;">]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    [</span><span style="color:#F78C6C;">26.5699186</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">106.517411</span><span style="color:#A6ACCD;">]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    [</span><span style="color:#F78C6C;">26.5899186</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">106.507411</span><span style="color:#A6ACCD;">]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  ])</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">addTo</span><span style="color:#A6ACCD;">(featureGroup)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  featureGroup</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">addTo</span><span style="color:#A6ACCD;">(map)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#82AAFF;">setTimeout</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">map</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">removeLayer</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">featureGroup</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">},</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2000</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>把要素添加到要素组中，然后把要素组添加到地图上，2 秒后移除要素组。</p><h2 id="关于聚合容差-tolerance" tabindex="-1">关于聚合容差 tolerance <a class="header-anchor" href="#关于聚合容差-tolerance" aria-hidden="true">#</a></h2><p>检测两个点是否重叠的容差，单位是像素，当小于这个容差时，两个点会被聚合在一起。</p><blockquote><p>如何测量页面上两个点之间的距离？</p></blockquote><h2 id="参考" tabindex="-1">参考 <a class="header-anchor" href="#参考" aria-hidden="true">#</a></h2><p><a href="https://stackblitz.com/edit/leaflet-d14?file=index.js" target="_blank" rel="noreferrer">Leaflet 进阶 D14--marker 聚合源码</a></p>`,36),o=[e];function r(c,t,i,y,F,D){return a(),n("div",null,o)}const u=s(p,[["render",r]]);export{A as __pageData,u as default};
