import{_ as s,o as n,c as a,a as l}from"./app.adb98358.js";const m=JSON.parse('{"title":"再学跨域（一） -- 同源策略","description":"","frontmatter":{},"headers":[{"level":2,"title":"如何判断是否同源？","slug":"如何判断是否同源","link":"#如何判断是否同源","children":[{"level":3,"title":"网站通过 CND 引入外部资源是什么情况呢？","slug":"网站通过-cnd-引入外部资源是什么情况呢","link":"#网站通过-cnd-引入外部资源是什么情况呢","children":[]},{"level":3,"title":"SameSite vs SameOrigin","slug":"samesite-vs-sameorigin","link":"#samesite-vs-sameorigin","children":[]},{"level":3,"title":"cookie 只能限制是否为同站，和同源有点区别","slug":"cookie-只能限制是否为同站-和同源有点区别","link":"#cookie-只能限制是否为同站-和同源有点区别","children":[]},{"level":3,"title":"form 是如何允许跨域写入的?","slug":"form-是如何允许跨域写入的","link":"#form-是如何允许跨域写入的","children":[]}]},{"level":2,"title":"小结","slug":"小结","link":"#小结","children":[]}],"relativePath":"web/js/再学跨域0.md"}'),p={name:"web/js/再学跨域0.md"},e=l(`<h1 id="再学跨域-一-同源策略" tabindex="-1">再学跨域（一） -- 同源策略 <a class="header-anchor" href="#再学跨域-一-同源策略" aria-hidden="true">#</a></h1><blockquote><p>关于博主：前端程序员，最近专注于 webGis 开发。加微信：MasonChou123，进技术交流群。</p></blockquote><p>浏览器的同源策略是一个重要的安全策略，它限制了只有来自本网站的<strong>JS 脚本</strong>才能<strong>读取</strong>自己网站里的资源：</p><ul><li>cookie、LocalStorage 和 IndexDB。</li><li>DOM 对象；</li><li>通过 fetch 、XMLHttpRequest 获取接口数据。</li></ul><p><strong>同源策略防止用户的数据被恶意窃取</strong>，但是也给开发带来了一些不便，比如无法通过 AJAX 跨域请求数据，给系统集成带来一些挑战。</p><p>用户登录了 <code>http://bank.com</code> ，然后访问了 <code>http://evil.com</code> ，如果 <code>http://evil.com</code> 可以读取 <code>http://bank.com</code> 的数据，那么用户的数据就会被泄露。</p><blockquote><p>同源策略是浏览器专属的，其他客户端没这种限制，比如 postman。</p></blockquote><h2 id="如何判断是否同源" tabindex="-1">如何判断是否同源？ <a class="header-anchor" href="#如何判断是否同源" aria-hidden="true">#</a></h2><p>两个 URL 的协议、域名、端口号都相同，就是同源，否则就是跨域。</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">scheme://host:port</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># 协议、域名、端口号相同才是同源</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>跨域后就不能访问对方的资源了，但是可以通过一些方式来实现跨域。</p><h3 id="网站通过-cnd-引入外部资源是什么情况呢" tabindex="-1">网站通过 CND 引入外部资源是什么情况呢？ <a class="header-anchor" href="#网站通过-cnd-引入外部资源是什么情况呢" aria-hidden="true">#</a></h3><p>网站常常需要通过引入外部资源，比如 JavaScript、css 等，这是什么回事？</p><p>某些情况跨域访问资源是被允许的：</p><ul><li><p>跨域嵌入：script、img、link、video、iframe、@font-face、background:url 等把外部资源嵌入文档中；</p></li><li><p>跨越写入：form 提交、a 链接；</p></li><li><p>跨域读取被禁止：读取 cookie，XMLHttpRequest 和 Fetch 读取 http 返回的数据。</p></li></ul><blockquote><p>总结：跨域限制 js 读写，但是允许 html 标签嵌入外部资源。</p></blockquote><h3 id="samesite-vs-sameorigin" tabindex="-1">SameSite vs SameOrigin <a class="header-anchor" href="#samesite-vs-sameorigin" aria-hidden="true">#</a></h3><p>如何区分同源和同站？</p><table><thead><tr><th>request from</th><th>request to</th><th>SameSite</th><th>SameOrigin</th></tr></thead><tbody><tr><td><a href="https://example.com" target="_blank" rel="noreferrer">https://example.com</a></td><td><a href="https://example.com" target="_blank" rel="noreferrer">https://example.com</a></td><td>true</td><td>true</td></tr><tr><td><a href="https://app.example.com" target="_blank" rel="noreferrer">https://app.example.com</a></td><td><a href="https://intranet.example.com" target="_blank" rel="noreferrer">https://intranet.example.com</a></td><td>true</td><td>false, 域名不同</td></tr><tr><td><a href="https://example.com" target="_blank" rel="noreferrer">https://example.com</a></td><td><a href="https://example.com:8080" target="_blank" rel="noreferrer">https://example.com:8080</a></td><td>true</td><td>false, 端口不同</td></tr><tr><td><a href="https://example.com" target="_blank" rel="noreferrer">https://example.com</a></td><td><a href="https://example.co.uk" target="_blank" rel="noreferrer">https://example.co.uk</a></td><td>false, 顶级域名不同</td><td>false, 域名不同</td></tr><tr><td><a href="https://example.com" target="_blank" rel="noreferrer">https://example.com</a></td><td><a href="http://example.com" target="_blank" rel="noreferrer">http://example.com</a></td><td>false, 协议不同</td><td>false, 协议不同</td></tr></tbody></table><blockquote><p>同站：协议相同，域名包含。同源：协议、域名、端口号相同。</p></blockquote><blockquote><p>不同站，一定不同源，不同源可能同站，同源要求更严格。</p></blockquote><p><a href="https://portswigger.net/web-security/csrf/bypassing-samesite-restrictions" target="_blank" rel="noreferrer">参考文章：Bypassing SameSite cookie restrictions</a></p><h3 id="cookie-只能限制是否为同站-和同源有点区别" tabindex="-1">cookie 只能限制是否为同站，和同源有点区别 <a class="header-anchor" href="#cookie-只能限制是否为同站-和同源有点区别" aria-hidden="true">#</a></h3><blockquote><p>只要 domain 和 path 相同，即可读取 cookie。</p></blockquote><p>两种设置 domain 的方式：</p><p>浏览器端： <code>document.domain = &#39;example.com&#39;</code></p><p><code>.a.example.com</code> 和 <code>.b.example.com</code> 相互读取对方的而 cookie。</p><p>服务器端： <code>set-cookie: key=value;domain = .example.com;path=/</code></p><p>https 才能读取</p><p>服务器端： <code>set-cookie: key=value;domain = .example.com;path=/;secure</code></p><p><a href="https://www.ruanyifeng.com/blog/2016/04/same-origin-policy.html" target="_blank" rel="noreferrer">跨域后规避上面三种限制的方式</a></p><h3 id="form-是如何允许跨域写入的" tabindex="-1">form 是如何允许跨域写入的? <a class="header-anchor" href="#form-是如何允许跨域写入的" aria-hidden="true">#</a></h3><p>form 提交是允许跨域的，但是只能提交 GET 和 POST 请求，不能提交其他请求。</p><div class="language-html line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">&lt;!--</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * @Author      : ZhouQiJun</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * @Date        : 2024-09-29 02:30:47</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * @LastEditors : ZhouQiJun</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * @LastEditTime: 2024-09-29 20:05:04</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * @Description : 关于博主：前端程序员，最近专注于 webGis 开发</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * @加微信：MasonChou123，进技术交流群</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">--&gt;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">&lt;!--</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">         enctype=&quot;text/plain&quot; 用于纯文本，调试时使用</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">         application/x-www-form-urlencoded 默认</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">         multipart/form-data 上传文件</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">         在 http：//localhost:3000 页面下提交表单到 http://localhost:5566</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    --&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">form</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">action</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">http://localhost:5566/form-post</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">method</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">post</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">accept-charset</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">utf-8</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">target</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">targetIfr</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">input</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">type</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">text</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">name</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">age</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> /&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">button</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">提交</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">button</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">form</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">form</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">action</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">http://localhost:5566/form-get</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">method</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">get</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">target</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">targetIfr</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">input</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">type</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">text</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">name</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">name</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> /&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">button</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">提交</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">button</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">form</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">iframe</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">name</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">targetIfr</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">style</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">display: none</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;&lt;/</span><span style="color:#F07178;">iframe</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><blockquote><p>iframe 用法保证提交后页面不会刷新。</p></blockquote><p>enctype 的会影响提交的数据格式， <code>application/x-www-form-urlencoded</code> 是默认的提交方式， <code>multipart/form-data</code> 用于上传文件。</p><p>在浏览器中，enctype 的会表现为 <code>Content-Type</code> 的值。</p><p>get 请求的数据会拼接到 url 后面，post 请求的数据会放到请求体中。</p><p>后端程序：</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">/*</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * @Author      : ZhouQiJun</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * @Date        : 2024-09-29 10:34:14</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * @LastEditors : ZhouQiJun</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * @LastEditTime: 2024-09-29 19:50:32</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * @Description : 关于博主：前端程序员，最近专注于 webGis 开发</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * @加微信         : MasonChou123，进技术交流群</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> express </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">express</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> bodyParser </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">body-parser</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> app </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">express</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// NOTE 没有启用跨域，form 表单依然能提交数据</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// app.use(function (req, res, next) {</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//   res.header(&#39;Access-Control-Allow-Origin&#39;, &#39;http://localhost:3000&#39;) // 第二个参数可以换成你的域名</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//   res.header(&#39;Access-Control-Allow-Credentials&#39;, true)</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//   res.header(&#39;Access-Control-Allow-Methods&#39;, &#39;POST, PUT, DELETE, OPTIONS&#39;)</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//   res.header(&#39;Access-Control-Allow-Headers&#39;, &#39;Content-Type&#39;)</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//   next()</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// })</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// host 静态资源，如图片等等</span></span>
<span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">use</span><span style="color:#A6ACCD;">(express</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">static</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./public</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">))</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 解析 form 表单提交的数据</span></span>
<span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">use</span><span style="color:#A6ACCD;">(bodyParser</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">urlencoded</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">extended</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">false</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">post</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/form-post</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">req</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">res</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">next</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">query</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">body</span><span style="color:#89DDFF;">?.</span><span style="color:#A6ACCD;">name</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">body</span><span style="color:#89DDFF;">?.</span><span style="color:#A6ACCD;">age</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">json</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    code</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    message</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">success</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/form-get</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">req</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">res</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">next</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">query</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">json</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    code</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    message</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">success</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 测试跨域请求的时候记得使用其他的端口，比如http://localhost:8080</span></span>
<span class="line"><span style="color:#A6ACCD;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">listen</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">5566</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">server is running at http://localhost:5566</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br></div></div><blockquote><p>为何 form 表单可以跨域提交数据？</p></blockquote><p>这是历史原因，互联网早期没有 XMLHttpRequest 和 JS，只能通过 form 表单提交数据，所以浏览器允许 form 表单跨域提交数据。</p><p>另一种解释，form 表单提交数据是一种用户行为，不是脚本行为，即没有使用 JS，表单提交后拿不到接口返回数据，所以浏览器允许 form 表单跨域提交数据。</p><blockquote><p>记住 form 的这个特性，后续学习 CORS 还是在理解它。</p></blockquote><h2 id="小结" tabindex="-1">小结 <a class="header-anchor" href="#小结" aria-hidden="true">#</a></h2><ul><li>同源策略是浏览器的安全策略，限制了 JS 脚本读取其他网站的资源。</li><li>两个 URL 的协议、域名、端口号都相同，就是同源，否则就是跨域。</li><li>跨域嵌入：script、img、link、video、iframe、@font-face、background:url 等把外部资源嵌入文档中。</li><li>跨域写入：form 提交、a 链接。</li><li>跨域读取被禁止：读取 cookie，XMLHttpRequest 和 Fetch 读取 http 返回的数据。</li><li>cookie 同源比较特殊，只要 domain 和 path 相同，即可读取 cookie。</li><li>form 提交是允许跨域的，但是只能提交 GET 和 POST 请求，不能提交其他请求。</li></ul><blockquote><p>关于博主：前端程序员，最近专注于 webGis 开发。加微信：MasonChou123，进技术交流群</p></blockquote>`,47),o=[e];function t(r,c,i,y,D,F){return n(),a("div",null,o)}const u=s(p,[["render",t]]);export{m as __pageData,u as default};
