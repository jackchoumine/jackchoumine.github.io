# 编写可读性代码的艺术

最近阅读了《编写可读代码的艺术》一书，感觉很有收获，现在结合自己的理解再来总结编写可读性代码的技巧。

学会该书的大部分技巧并付诸实践，不能保证保证你写出完美的代码，但是能保证你写出能读的代码，保证你的**码德**下限。

可读性 = 可测试性 = 设计良好 = 可维护 = 代码质量 = ...，衡量代码的各种指标，都是正相关的，开发程序的大部分时间是在阅读代码（自己的和他人的），所以保证了可读性，其他指标也不会差。

## 衡量代码的可读性

大部分程序员，全靠自觉、灵感和经验编写代码，往往很难一步到位写出可读性高的代码。

我看过一些前端组长、前端架构写的代码，简直惨不忍睹，让人有骂娘的冲动。

比如这种：

![](https://cdn.jsdelivr.net/gh/jackchoumine/jack-picture@master/bad-render-chart.png)

还有行宽过大，编辑器都出现滚动条了，也会让人不想读。

不可读的代码往往都会有这样或那样的问题。

> 软件的成本由开发成本和维护成本组成，而往往维护成本要远高于开发成本，维护成本主要花在理解代码和修改代码上，可读性高、设计良好的代码可大大降理解和修改代码的成本。

可见代码的可读性至关重要。

### 如何衡量代码的可读性呢？

> 代码可读性和代码被他人理解的时间成正比，即他人**理解**代码的时间越少，可读性越高。

如何定义他人？根据我的经验，高年级本科生或者研究生或者工作 2 年内的程序员，又或者，你的一个普通同事。

> 同事是和你协作的人，让和你协作的人能快速地理解你的代码，至关重要。

如何定义理解？

理解是一个非常高的标准。真正理解了，就应该能**改动**它、**找出缺陷**且明白它**与外部代码交互的规则**。

### 可读性的标准可以降低吗？

当可读性和其他约束条件冲突时，比如性能、代码行数，如何取舍？

> 大部分情况，**可读性优先**，那些可能会经常被他人阅读、改动的代码，可读性再怎么强调都不为过。

### 编写可读性的代码很难吗？

编写可读性高的代码很难。如果一个程序员放弃了可读性这一目标，那么他一定不会成为更好的程序员。

编写可读性高的代码，前人已经总结了诸多技巧和经验，学习并实践这些经验，可以让代码的可读性不至于很糟糕。

## 命名的技巧

好的代码，从好的命名开始。

### 把信息放在名字里

1. 选择专业的词汇，然后意思更加**清晰和精确**。比如`fetchData`比`getData`好；

| 单词  | 更多的选择                                                                               |
| ----- | ---------------------------------------------------------------------------------------- |
| send  | deliver、dispatch(派发)、announce(声明)、distribute(分配、广播)、route(按照指定路径投送) |
| find  | search、extract(提取)、locate(定位)、recover(还原)                                       |
| start | launch、create(创建)、begin、open                                                        |
| make  | create、setup(就绪)、build、generate(生成)、compose、add、new                            |

2. 避免宽泛的名字，除非有特别的理由

避免使用 `tmp` 、 `retval` 这类宽泛的名字。**好的名字应该描述变量的目的或者它承载的值**， `tmp_file` 比如 `tmp` 好。

```js
const euclidean_norm = arr => {
  let retval = 0
  for (let i = 0 i < arr.length; i++) {
    retval += arr[i] * arr[i]
  }
  return Math.sqrt(retval)
}
```

> 这函数在累加数组中元素的平法，把 `retval` 改成 `sum_squares` 更好。

> sum_squares 包含它的目的，如果累加代码不小心写成 `retval += arr[i]` ，就非常容易发现缺陷。

> 使用 tmp、it 和 retval 等这些空范的名字时，你需要有足够好的理由。

3. 使用具体的名字，避免抽象的名字

4. 把重要的信息附加到名字上

常见的可以附加的信息：

① 单位

| 函数参数     | 参数带单位          |
| ------------ | ------------------- |
| start(delay) | delay -> delay_secs |
| createCache(size)  | size -> size_mb     |
| throttleDownload(limit)  | limit -> max_kbps     |
| rotate(angle)  | angle -> degrees_cw     |

> angle 角度，单位度。cw(circular_measure)，弧度。

在一个项目遇到一个函数的参数对象属性为 `rotate` :

```js
someFunction({
  rotate: rotate_value
})
```

它接收一个从后台接口返回的值，采用的单位是度，产品经理一直说不对，但是我们也找不到问题，就把这个问题放了很久。产品经理有一天又去找人确认是否正确，给的答复没问题。

产品又来找我，说那边反馈数据对的。我才猛然想到采用的单位是不是弧度，于是我把角度转成了弧度，产品就说对了。如果给属性加上单位，那么就一眼看出来了。

> 我们这个项目还涉及角度的方向，最后几经测试，需要做两件事情：角度转为弧度；三维地图下，旋转方向为逆时针。

> 把单位加入参数。

```js
someFunction({
  route_cw: cw_value // 顺时针的弧度 anticlockwise/counterclockwise 逆时针
})
```

> 如果把三维地图下逆时针也加入，参数就长了，选择不加，可通过函数注释的方式告知使用者。

② 格式

③

5. 变量作用域大小决定名字长短

谨慎使用缩略词、自己造词。

6. 使用格式表示含义

遵循编程语言或者团队的约定，且保持一致。

比如 js 中，构造函数使用大坨峰(Person)，普通函数使用小驼峰(person)。

### 不要使用有歧义的名字

## 参考

![](https://pegasuswang.readthedocs.io/zh/latest/code/%E7%BC%96%E5%86%99%E5%8F%AF%E8%AF%BB%E4%BB%A3%E7%A0%81%E7%9A%84%E8%89%BA%E6%9C%AF/)

![](https://pdai.tech/md/about/book/book-read-code-art.html#%E3%80%8A%E7%BC%96%E5%86%99%E5%8F%AF%E8%AF%BB%E4%BB%A3%E7%A0%81%E7%9A%84%E8%89%BA%E6%9C%AF%E3%80%8B)
