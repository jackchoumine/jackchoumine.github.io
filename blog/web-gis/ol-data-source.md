# ol 之多源数据展示

随着 web 技术持续发展，地图展示的数据来源越来越丰富，格式众多，如何将**多源异构数据**展示在地图上，成为 webGIS 的关键问题。

ol 为多源异构数据的展示提供了很好的支持。

## 加载数据的原理

地图形式：矢量地图和瓦片地图。

### 矢量地图

两种方式加载矢量地图

1. 从远程服务加载矢量数据；

2. 从本地读取矢量数据，比如 GML、KML、GeoJSON 等文件。

加载原理：通过 ajax 请求地图服务或者读取本地数据，在浏览器**实时生成**矢量图层。

### 瓦片地图

将图层分成类似瓦片的图片，从服务器或者本地目录加载这些图片，在浏览器里组合成图层。

浏览器加载瓦片地图也有两种方式：

1. 调用瓦片图片接口，从远程加载；

2. 从本地读取瓦片图片。

加载原理：通过 ajax 请求地图服务或者读取本地数据，根据瓦片的**放缩级别**、**行列号**分别获取瓦片，按照请求的**空间范围**组织好(即按照网格组织瓦片地图)，从而形成一幅地图并显示在网页上。

### 两者的区别

主要区别试预处理机制不同。

瓦片地图通过剪切处理，已经形成缓存图片集，加载比实时生成图片快。出图较快，满足网络环境不够好和地图变更少的情况。

矢量地图加载时需要实时生成图片，加载时比瓦片地图慢。满足实时数据处理、分析要求，适用范围广。

## ol 加载数据的方式

ol 将**图层**和**数据源**分离，图层作为渲染地图数据的容器，而数据作为 GIS 信息的载体，数据源是数据的提供者，图层要与数据源匹配。

图层和数据源均分为三种：Image、Tile、Vector，在实例化图层对象时，其数据源类型要与图层类型匹配。

1. 瓦片地图

使用 `ol/layer.Tile` + `ol/source.Tile` 方式加载。

`ol/layer.Tile` 为封装各种瓦片地图数据源提供扩展支持。

<!-- TODO 如何扩展 -->

瓦片地图也可以使用 `ol/layer.Image` + `ol/source.Image` 方式加载。

2. 矢量地图

使用 `ol/layer.vector` + `ol/source.Vector` 方式加载。

矢量地图数据源有两种方式：

features 加载：设置 features 参数静态加载矢量地图，或者 addFeature 或 addFeatures 加载动态矢量地图。

url + format 加载：设置 url 和 format 参数，通过 ajax 请求数据源加载矢量地图。

## 开放数据格式

为了更好的共享和聚合地图的目的，让 GIS 数据使用更加灵活、应用范围更加广泛，制定一些通用的数据格式，如 GeoJSON、KML、GML 等。

1. KML

KML 是一种基于 XML 的数据格式，用于描述和标注地理信息，由 Keyhole （Google Earth 的前身） 开发，支持从类似谷歌地球、微软虚拟地球、ol 等地图平台导入导出数据。

被 OGC 采用，标准由 OGC 维护。

2. GML

GML(Geography Markup Language) 由 OGC 提出，能表示地理空间对象的空间数据和非空间数据。

3. GPX

GPX(GPS eXchange Format) 是一种 XML 格式，用于描述 GPS 路径、轨迹、航迹等信息。

4. GeoJSON

GeoJSON 是一种基于 JSON 的数据格式，用于描述地理信息。

可表示几何特征和特征集合，支持点、线、面、多点、多线、多面、几何集合等几何类型。

GeoJSON 包含一个几个对象及其属性，特征集合表示一系列特征。

ol 提供了解析这些数据格式的类，对应 `Format` 的子类。

### 加载 GeoJSON 数据

<!-- TODO 5.3.1 -->

### 加载 KML 数据

<!-- TODO 5.3.2 -->

### 加载 GPX 数据

<!-- TODO 5.3.3 -->

## 公共地图数据

一些地图服务商，如谷歌地图、高德地图、百度地图、OpenStreetMap、天地图等，提供了大量地图服务资源，可免费使用，一般以瓦片地图的形式提供，作为底图。

ol 提供了对这些地图服务的支持，可直接使用 ol 的 API 使用这些服务，比如 OpenStreetMap、Bing 地图，可直接使用它们实例化数据源，结合瓦片图层来加载对应的地图数据。

ol 没有提供特别支持的服务商，比如百度地图、天地图等，可通过 ol 的 `ol/source.XYZ` 类实现。

### 加载 OpenStreetMap 数据

<!-- TODO 5.4.1 -->

## 矢量瓦片

<!-- 5.5 -->
